<div class="loader" id="appLoading">Loading...</div>
<div id="app">
  <div class="nav">
    <div class="left">
      <h1 class="title">Create an app</h1>
      <span class="ml8">Create a new application through the registry</span>
    </div>
    <div class="right">
      <vscode-text-field @input="updateKeyword(event)">
        <span
          slot="end"
          class="codicon codicon-search search"
          @click="search()"
          @keyup.enter="search()"
        ></span>
      </vscode-text-field>
    </div>
  </div>
  <div class="app-panel" v-if="pageStatus === 'search'">
    <vscode-panels aria-label="Default">
      <vscode-panel-tab id="tab-1">All apps</vscode-panel-tab>
      <vscode-panel-tab id="tab-2">Recommended apps</vscode-panel-tab>
      <vscode-panel-view id="view-1">
        <div class="app-area">
          <div class="app-items mr16">
            <ul>
              <li v-for="i in applicationList" class="app-card">
                <div class="head">
                  <span class="title">{{ i.package }}</span>
                  <div style="display: inline-block">
                    <i class="codicon codicon-arrow-circle-down"></i
                    ><span style="margin-left: 2px">{{ i.download }}</span>
                  </div>
                </div>
                <div class="detail">{{ i.description }}</div>
                <div class="app-buttons">
                  <vscode-button
                    @click="openUrl(i.package)"
                    appearance="secondary"
                    >See details</vscode-button
                  >
                  <vscode-button @click="switchStatus('init', i.package)"
                    >Create now</vscode-button
                  >
                </div>
              </li>
            </ul>
          </div>
          <div class="condition-filter">
            <div class="ranking">
              <vscode-dropdown
                style="width: 150px"
                @change="sortBySelected(event)"
              >
                <vscode-option id="download">Sort by downloads</vscode-option>
                <vscode-option id="time">Sort by time</vscode-option>
              </vscode-dropdown>
            </div>
            <div class="category">
              <p>category</p>
              <ul class="list">
                <li
                  class="list-item"
                  @click="filterAppList('category', i)"
                  v-for="i in categoryList"
                >
                  {{ i }}
                </li>
              </ul>
            </div>
          </div>
        </div>
      </vscode-panel-view>
      <vscode-panel-view id="view-2"> None </vscode-panel-view>
    </vscode-panels>
  </div>
  <div class="init" v-else-if="pageStatus === 'init' ">
    <div class="config">
      <vscode-text-field
        class="config-item"
        @change="setConfigItem('dirName',event)"
        :value="configItems['dirName']"
      >
        <span class="red-star">*&nbsp;</span>App name (directory name)
      </vscode-text-field>
      <vscode-text-field
        class="config-item"
        :value="configItems.path"
        @click="setInitPath()"
      >
        <span class="red-star">*&nbsp;</span>Initialize the path
        <span slot="end" class="codicon codicon-file-submodule"></span>
      </vscode-text-field>
      <div class="config-item">
        <p style="margin: 0">
          <span class="red-star">*&nbsp;</span>Select the credential
        </p>
        <vscode-dropdown @change="setConfigItem('access',event)">
          <vscode-option v-for="i in $config.aliasList">{{ i }}</vscode-option>
        </vscode-dropdown>
      </div>
      <div v-for="(param, name) in currentAppParams">
        <vscode-text-field
          class="config-item"
          v-if="!param.enum"
          @change="setConfigItem(name, event)"
          :value="param.default"
        >
          <span class="red-star" v-if="isRequire(name)">*&nbsp;</span>{{
          param.title }}
        </vscode-text-field>
        <div class="config-item" v-else>
          <p style="margin: 0">
            <span class="red-star" v-if="isRequire(name)">*&nbsp;</span>{{
            param.title }}
          </p>
          <vscode-dropdown @change="setConfigItem(name, event)">
            <template v-for="item in param.enum">
              <vscode-option v-if="item === param.default" selected
                >{{ item }}</vscode-option
              >
              <vscode-option v-else>{{ item }}</vscode-option>
            </template>
          </vscode-dropdown>
        </div>
      </div>
    </div>
    <div class="init-buttons">
      <vscode-button @click="switchStatus('search')" appearance="secondary"
        >上一步</vscode-button
      >
      <vscode-button @click="initApplication()">Create</vscode-button>
    </div>
  </div>
</div>
